---
/**
 * Projects Index Template
 *
 * Self-fetching template for the projects index page.
 * Fetches its own data and all projects based on preview mode.
 */
import BaseLayout from '../../layouts/BaseLayout.astro'
import { getAllProjects } from '../../data/sanity'
import Media from '../media/Media.svelte'

interface Props {
  isPreview?: boolean
}

const { isPreview = false } = Astro.props

const projects = await getAllProjects({ preview: isPreview })

const title = 'Projects'
const description = ''
---

<BaseLayout title={title} description={description} isPreview={isPreview} pagePath="/projects">
  <main class="projects-index main-grid">
    <section class="projects-header">
      <h1>Projects</h1>
    </section>

    {
      projects && projects.length > 0 && (
        <section class="projects-grid">
          {projects.map((project) => (
            <a href={`/projects/${project.slug?.current}`} class="project-card">
              <div class="media-wrapper">
                {project.mediaGallery?.[0] && (
                  <Media media={{ image: project.mediaGallery[0] }} layout="cover" client:visible />
                )}
              </div>
              <h3>{project.titre}</h3>
            </a>
          ))}
        </section>
      )
    }
  </main>

  <style>
    .projects-header {
      grid-column: 1 / -1;
      margin-block: var(--size-64) var(--size-32);
    }

    .projects-grid {
      grid-column: 1 / -1;
      display: grid;
      grid-template-columns: subgrid;
    }

    .project-card {
      grid-column: span 4;
      text-decoration: none;
      color: inherit;
    }

    .media-wrapper {
      aspect-ratio: 3 / 2;
      overflow: hidden;
      margin-block-end: var(--size-12);
    }

    .project-card h3 {
      font-size: var(--text-18);
    }
  </style>
</BaseLayout>
