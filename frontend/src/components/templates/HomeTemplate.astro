---
/**
 * Home Template
 */
import BaseLayout from '../../layouts/BaseLayout.astro'
import { getHomePage } from '../../data/sanity'
import Media from '../media/Media.svelte'

interface Props {
  isPreview?: boolean
}

const { isPreview = false } = Astro.props

const homePage = await getHomePage({ preview: isPreview })

const title = homePage?.seo?.title || homePage?.title || 'Accueil'
const description = homePage?.seo?.description || 'Jacquard Espaces Verts'
---

<BaseLayout title={title} description={description} isPreview={isPreview} pagePath="/">
  <main class="home-page">
    {
      homePage?.sections?.map((section) => {
        if (section._type === 'homeSectionProjectReference') {
          const project = section.project
          if (!project) return null

          const href = project.slug?.current ? `/projects/${project.slug.current}` : '#'

          if (section.displayMode === 'carouselImage') {
            return (
              <section class="section section-project-carousel main-grid">
                <a href={href} class="project-block-link project-block-link-inline">
                  <h2>{project.titre}</h2>
                </a>
                <div class="project-carousel-track">
                  {project.mediaCarousel?.map((image) => (
                    <figure class="project-carousel-item">
                      <Media media={{ image }} layout="cover" client:visible />
                    </figure>
                  ))}
                  {(!project.mediaCarousel || project.mediaCarousel.length === 0) &&
                    project.heroMedia && (
                      <figure class="project-carousel-item project-carousel-item-fallback">
                        <Media media={project.heroMedia} layout="cover" client:visible />
                      </figure>
                    )}
                </div>
              </section>
            )
          }

          return (
            <section class="section section-project-fullscreen">
              <a href={href} class="project-block-link">
                <Media media={project.heroMedia} layout="cover" client:visible />
                <p class="overlay-text">{project.titre}</p>
              </a>
            </section>
          )
        }

        if (section._type === 'homeSectionProjectPair') {
          const projects = section.projects?.filter((project) => !!project) || []

          return (
            <section class="section section-project-pair main-grid">
              {projects.map((project) => (
                <a
                  href={project.slug?.current ? `/projects/${project.slug.current}` : '#'}
                  class="project-pair-item"
                >
                  <Media media={project.heroMedia} layout="cover" client:visible />
                  <p class="overlay-text">{project.titre}</p>
                </a>
              ))}
            </section>
          )
        }

        if (section._type === 'homeSectionExpertiseReference') {
          return (
            <section class="section section-expertise main-grid">
              <div class="section-expertise-content">
                <h2>{section.expertise?.title}</h2>
                {section.expertise?.description && <p>{section.expertise.description}</p>}
              </div>
            </section>
          )
        }

        return null
      })
    }
  </main>

  <style>
    .home-page {
      display: flex;
      flex-direction: column;
      gap: var(--size-24);
      padding-bottom: var(--size-64);
    }

    .section {
      position: relative;
    }

    .section-project-fullscreen {
      aspect-ratio: 1440 / 766;
      min-height: 50vh;
    }

    .project-block-link {
      display: block;
      position: relative;
      width: 100%;
      height: 100%;
      color: inherit;
      text-decoration: none;
    }

    .project-block-link-inline {
      grid-column: 1 / -1;
      display: inline-flex;
      width: fit-content;
      color: var(--color-primary);
      text-decoration: none;
      border-bottom: 1px solid var(--color-primary);
      margin-bottom: var(--size-16);
    }

    .project-block-link-inline h2 {
      font-size: var(--text-18);
      text-transform: uppercase;
      margin: 0;
    }

    .section-project-pair {
      gap: var(--size-16);
    }

    .project-pair-item {
      grid-column: 1 / -1;
      position: relative;
      aspect-ratio: 3 / 2;
      min-height: 40vh;
      color: inherit;
      text-decoration: none;
    }

    .overlay-text {
      position: absolute;
      inset-inline: var(--size-24);
      bottom: var(--size-24);
      color: var(--color-secondary);
      font-size: var(--text-16);
      font-weight: var(--font-weight-medium);
      text-transform: uppercase;
      text-align: center;
      z-index: var(--z-base);
    }

    .project-carousel-track {
      grid-column: 1 / -1;
      display: flex;
      gap: var(--size-12);
      overflow-x: auto;
      scroll-snap-type: x mandatory;
      padding-bottom: var(--size-8);
    }

    .project-carousel-item {
      flex: 0 0 85%;
      aspect-ratio: 4 / 3;
      scroll-snap-align: start;
      position: relative;
      overflow: hidden;
      margin: 0;
    }

    .project-carousel-item-fallback {
      flex-basis: 100%;
    }

    .section-expertise-content {
      grid-column: 1 / -1;
      text-align: center;
      display: grid;
      gap: var(--size-16);
      padding-block: var(--size-24);
    }

    .section-expertise-content h2 {
      font-size: var(--text-24);
      font-weight: var(--font-weight-medium);
      text-transform: uppercase;
      margin: 0;
    }

    .section-expertise-content p {
      font-size: var(--text-18);
      line-height: var(--line-height-normal);
      max-width: 56ch;
      margin-inline: auto;
      margin-block: 0;
    }

    @media (min-width: 768px) {
      .project-pair-item {
        grid-column: span 4;
      }

      .project-carousel-track {
        overflow: visible;
        display: grid;
        grid-template-columns: repeat(4, minmax(0, 1fr));
      }

      .project-carousel-item {
        flex: unset;
        aspect-ratio: 1 / 1;
      }
    }
  </style>
</BaseLayout>
