---
/**
 * Project Template
 *
 * Two-section layout:
 * - Section 1: 100vh hero with click-left/right image carousel + project title
 * - Section 2: Info grid, thumbnails, and next project CTA
 */
import BaseLayout from '../../layouts/BaseLayout.astro'
import { getProjectWithNext } from '../../data/sanity'
import type { NextProjectData } from '../../data/sanity'
import { urlFor } from '../../utils/sanity/image'
import ProjectPage from './ProjectPage.svelte'

interface Props {
  currentSlug: string
  isPreview?: boolean
  nextProject?: NextProjectData | null
}

const { currentSlug, isPreview = false, nextProject: nextProjectProp } = Astro.props

const { project, nextProject: computedNext } = await getProjectWithNext(currentSlug, {
  preview: isPreview,
})
const nextProject = nextProjectProp ?? computedNext

const title = project?.seo?.title || project?.titre
const description = project?.seo?.description || project?.localisation || ''
const mainImage = project?.mediaGallery?.[0]
let image: string | undefined
const rawImage = project?.seo?.image || mainImage
if (rawImage) {
  image = urlFor(rawImage).width(1200).height(630).url()
}
---

<BaseLayout
  title={title}
  description={description}
  image={image}
  isPreview={isPreview}
  pagePath={`/projects/${currentSlug}`}
  hideHeader={true}
  contentBackground="var(--color-white)"
>
  {
    project && (
      <main class="project-template main-grid">
        <ProjectPage project={project} nextProject={nextProject} client:load />
      </main>
    )
  }

  <style>
    .project-template {
      background: var(--color-white);
    }
  </style>
</BaseLayout>
